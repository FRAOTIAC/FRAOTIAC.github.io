---
layout: post
title: Reproduce SWE-agnet
date: 2025-03-18
tags: [SWE-agnet, claude, deepseek]
categories: [SWE-agnet]
---
# å‰è¨€

Reproduction of SWE-bench resultsÂ #1014

[New issue](https://github.com/SWE-agent/SWE-agent/issues/new/choose)

ä½¿ç”¨cluade-3-5-sonnet æ¥å°è¯•å¤ç°ï¼Œç»è¿‡æœç´¢å¾—åˆ°ä¸Šé¢çš„è¯·æ±‚å¤ç°æ–¹æ³•çš„issueï¼Œæœ€ç»ˆæŒ‡å‘è¿™ä¸ªé…ç½®æ–‡ä»¶

[SWE-agent/config/sweagent_heavy_sbl_250212.yaml at 1c534b9f439b5d4ce936601527c084b06685c3e5 Â· SWE-agent/SWE-agent Â· GitHub](https://github.com/SWE-agent/SWE-agent/blob/1c534b9f439b5d4ce936601527c084b06685c3e5/config/sweagent_heavy_sbl_250212.yaml)

é…ç½®æ–‡ä»¶ä¸­ç»è¿‡å¯¹æ¯”å‘ç°ï¼Œé‡Œé¢åšçš„æ¯”è¾ƒå¤æ‚ï¼Œå‡ºå»æ™®é€šçš„æ¨¡å‹é…ç½®ï¼ˆdefaultï¼‰ï¼Œè¿˜å¢åŠ äº†reviewerçš„é…ç½®ï¼ˆchooserï¼‰

ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶è¿è¡Œï¼Œæœ€ç»ˆåœ¨å‰5ä¸ªåˆ†ç‰‡ä¸­ï¼ŒæˆåŠŸä¿®å¤äº†ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå•æ¬¡æäº¤å¾—åˆ°äº†100%(1/1)çš„ä¿®å¤ç‡ã€‚

```bash
sb-cli get-report swe-bench_lite test sweagent_heavy_sbl_250212__unknown___swe_bench_lite_test_20250318125416068111
Resolved (total): 0.33% (1 / 300)
Resolved (submitted): 100.00% (1 / 1)
Submitted: 0.33% (1)
Errors: 0
Pending: 0
Successful runs: 1
Failed runs: 0
Saved full report to sb-cli-reports/swe-bench_lite__test__sweagent_heavy_sbl_250212__unknown___swe_bench_lite_test_20250318125416068111.json!
```

instance ä¿¡æ¯

```bash
    "django__django-16139": {
        "model_name_or_path": "sweagent_heavy_sbl_250212__unknown___swe_bench_lite_test",
        "instance_id": "django__django-16139",
```

# ç¯å¢ƒé…ç½®é¡»çŸ¥

[princeton-nlp/SWE-bench_Lite Â· Datasets at Hugging Face](https://huggingface.co/datasets/princeton-nlp/SWE-bench_Lite/sql-console/fCj5cMg)

ä¸Šé¢è¿™ä¸ªæ˜¯è¿è¡ŒæˆåŠŸçš„æ•°æ®é›†ï¼Œè®©æˆ‘ä»¬æ€»ç»“ä¸‹ï¼Œä¸ºäº†æˆåŠŸè¿è¡Œï¼Œéœ€è¦é‚£äº›æ­¥éª¤ï¼š

1. é…ç½®`OPENAI_API_KEY`ï¼Œ`OPENAI_API_BASE_URL`å’Œ`SWEBENCH_API_KEY` åˆ°`.env` æ–‡ä»¶ä¸­
   
   `swe-agent` ä¼šè¯»å–åœ¨å…¶ä»£ç è·¯å¾„ä¸‹çš„ `.env` æ–‡ä»¶ï¼Œæ¥è·å–è¿™äº›å¯†é’¥ä¿¡æ¯
   
   è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœsweagentä½¿ç”¨litellmä½œä¸ºapiæä¾›å•†çš„ç»Ÿä¸€å…¥å£ï¼Œåœ¨ä½¿ç”¨deepseek apiçš„æ—¶å€™ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹æ€§
   
   1. baseurlä¸éœ€è¦`/v1`è¿™ä¸ªè·¯å¾„
   2. æ¨¡å‹éœ€è¦åŠ å…¥deepseek å‰ç¼€ï¼Œè¡¨ç¤ºllm providerã€‚
   
   å› æ­¤éœ€è¦å¦‚ä¸‹ï¼š
   
   ```
   OPENAI_API_BASE_URL="<https://api.deepseek.com/>"
   ...
   # in config file
   name: deepseek/deepseek-coder
   ```

2. configé…ç½®
   
   æ³¨æ„åœ¨`config`æ–‡ä»¶å¤¹ä¸­ï¼ŒåŒ…å«å¾ˆå¤šconfigæ–‡ä»¶ï¼Œæ¯”å¦‚`default`ï¼Œ`thought_action`ç­‰ï¼Œæ³¨æ„å¯ä»¥å¤ç°`sweagent`ç»“æœçš„é…ç½®æ–‡ä»¶ï¼Œæ˜¯`250212_sweagent_heavy_sbl.yaml` è¿™ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿™é‡Œé¢å¯¹åº”çš„ä¿®æ”¹`api_key`å³å¯ï¼Œåœ¨æ–‡ä»¶å¼€å¤´çš„æ³¨é‡Šä¸­ï¼Œè¿˜æœ‰å‚è€ƒçš„è¿è¡Œå‘½ä»¤
   
   ```
   # sweagent run-batch --num_workers=12 --instances.type=swe_bench --instances.subset=lite --instances.split=test
   # --instances.shuffle=True --instances.evaluate=True --instances.deployment.docker_args=--memory=10g --config config/retry_heavy_v3.yaml --instances.slice :100
   ```

3. ç”±äºClaudeçš„apiæ¯”è¾ƒè´µï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®æ•°æ®é›†åˆ†ç‰‡ä¸ºå‰5ä¸ªï¼š `--instances.slice :5` ä»¥åŠå¹¶è¡Œåº¦é™ä½ä¸º1ï¼š `--num_workers=1`

4. ç›®å‰ä½¿ç”¨deepseekçš„æ¨¡å‹ï¼Œåœ¨function callingçš„åŠŸèƒ½ä¸Šå¹¶ä¸ç¨³å®šï¼Œå› æ­¤åœ¨è¿è¡Œä¸­ç»å¸¸ä¼šé‡åˆ°æ¨¡å‹è¾“å‡ºæ ¼å¼ä¸æ­£ç¡®ï¼Œå¯¼è‡´è¿›å…¥æ— é™å¾ªç¯çš„é”™è¯¯ã€‚

å¦‚æœä»¥ä¸Šè®¾ç½®éƒ½æ­£ç¡®ï¼Œä½¿ç”¨`claude-3-5-sonnet-20241022` åº”å¯ä»¥å¾—åˆ°æ¯”è¾ƒå¥½çœ‹çš„æˆåŠŸç‡ï¼Œä»¥åŠå¤ç°sweagentçš„æˆç»©ã€‚

# ç»“æœè§£è¯»

åœ¨è¿è¡Œå®Œæˆä¹‹åï¼Œä¼šåœ¨trajectoriesç›®å½•ä¸‹è·å¾—è¿è¡Œlogè®°å½•ï¼Œæ¯”å¦‚ï¼š

```bash
SWE-agent/trajectories/lucas/sweagent_heavy_sbl_250212__unknown___swe_bench_lite_test/django__django-16139/django__django-16139.debug.log
```

åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°sweagentåœ¨è§£å†³è¿™ä¸ªé—®é¢˜ä¸Šçš„æ­¥éª¤è®°å½•ï¼Œæˆªè‡³ç›®å‰ä¸ºæ­¢çš„ç‰ˆæœ¬ï¼Œæ˜¯å¦‚ä¸‹æ­¥éª¤ï¼š

## ç¯å¢ƒå‡†å¤‡

å¯ä»¥çœ‹åˆ°å…¶è°ƒç”¨rex-deployæ¥é…ç½®docker containerè¿è¡Œæ—¶ï¼Œè°ƒç”¨swea-envåˆå§‹åŒ–è¿è¡Œæ—¶ä»¥åŠå‡†å¤‡toolsï¼Œswea-lm æ¥åˆå§‹åŒ–æ¨¡å‹ï¼Œswea-agentæ¥åˆå§‹åŒ–agentå®ä¾‹

```bash
2025-03-18 11:59:54,318 - INFO - rex-deploy - Building image swebench/sweb.eval.x86_64.django_1776_django-16139:v1 to install a standalone python to /root. This might take a while (but you only have to do it once). To skip this step, set `python_standalone_dir` to None.
2025-03-18 11:59:55,243 - DEBUG - free_port - Found free port 37451
2025-03-18 11:59:55,245 - INFO - rex-deploy - Starting container swebenchsweb.eval.x86_64.django_1776_django-16139v1-b614c09e-83c6-4f1e-b6bd-d7e161b67ef9 with image swebench/sweb.eval.x86_64.django_1776_django-16139:v1 serving on port 37451
2025-03-18 11:59:55,248 - DEBUG - rex-deploy - Command: "docker run --rm -p 37451:8000 --platform linux/amd64 --memory=10g --name swebenchsweb.eval.x86_64.django_1776_django-16139v1-b614c09e-83c6-4f1e-b6bd-d7e161b67ef9 sha256:2ea9999dfde9d8a8e135f0d5d465777d3dbb9ce75344055c4401019bacb7620e /bin/sh -c '/root/python3.11/bin/swerex-remote --auth-token 8b96a624-10a5-4d9b-b0b0-07934284c45b'"
2025-03-18 11:59:55,252 - INFO - rex-deploy - Starting runtime at 37451
2025-03-18 11:59:57,495 - INFO - rex-deploy - Runtime started in 2.24s
2025-03-18 11:59:58,409 - INFO - swea-env - Environment Initialized
2025-03-18 11:59:58,643 - DEBUG - swea-env - Resetting repository testbed to commit d559cb02da30f74debbb1fc3a46de0df134d2d80
2025-03-18 12:00:01,448 - INFO - swea-lm - Using model: o1
2025-03-18 12:00:01,451 - INFO - swea-lm - Using model: claude-3-5-sonnet-20241022
2025-03-18 12:00:01,455 - INFO - swea-agent - Setting up agent for instance django__django-16139
2025-03-18 12:00:01,457 - INFO - swea-agent - Trajectory will be saved to /home/lucas/wsl2_workshop/SWE-agent/trajectories/lucas/sweagent_heavy_sbl_250212__unknown___swe_bench_lite_test/django__django-16139/attempt_0/django__django-16139.traj
2025-03-18 12:00:01,460 - DEBUG - swea-env - No environment variables to set
2025-03-18 12:00:01,575 - DEBUG - rex-runtime - Uploading file from /home/lucas/wsl2_workshop/SWE-agent/tools/registry to /root/tools/registry
2025-03-18 12:00:01,579 - DEBUG - rex-runtime - Created zip file at /tmp/tmpz57604sp/zipped_transfer.zip
2025-03-18 12:00:01,597 - DEBUG - rex-runtime - Uploading file from /home/lucas/wsl2_workshop/SWE-agent/tools/edit_anthropic to /root/tools/edit_anthropic
2025-03-18 12:00:01,605 - DEBUG - rex-runtime - Created zip file at /tmp/tmp92vmbbtd/zipped_transfer.zip
2025-03-18 12:00:01,622 - DEBUG - rex-runtime - Uploading file from /home/lucas/wsl2_workshop/SWE-agent/tools/review_on_submit_m to /root/tools/review_on_submit_m
2025-03-18 12:00:01,627 - DEBUG - rex-runtime - Created zip file at /tmp/tmpk3_wyqn8/zipped_transfer.zip
2025-03-18 12:00:01,640 - DEBUG - rex-runtime - Uploading file from /home/lucas/wsl2_workshop/SWE-agent/tools/diff_state to /root/tools/diff_state
2025-03-18 12:00:01,644 - DEBUG - rex-runtime - Created zip file at /tmp/tmp5l9w138u/zipped_transfer.zip
2025-03-18 12:00:08,960 - INFO - swea-tools - Resetting tools
2025-03-18 12:00:08,963 - DEBUG - swea-env - No environment variables to set
```

## é—®é¢˜è§£å†³å¾ªç¯

1. promptæ¨¡æ¿åˆå§‹åŒ–
   
   åœ¨è¿™é‡Œåˆå§‹åŒ–system_promptï¼Œuse_promptï¼Œè¿™äº›éƒ½å®šä¹‰åœ¨configæ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚ï¼š
   
   ```
   templates:
          system_template: *system_template
          instance_template: *instance_template
          next_step_template: *next_step_no_diff
          next_step_no_output_template: *next_step_no_output_no_diff
   ```
   
   å…·ä½“è¿è¡Œæ—¶çš„æ‰“å°ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼š
   
   ```
   2025-03-18 12:00:09,208 - INFO - swea-agent - SYSTEM (main)
   You are a helpful assistant that can interact with a computer to solve tasks.
   2025-03-18 12:00:09,576 - INFO - swea-agent - ğŸ¤– MODEL INPUT
   <uploaded_files>
   /testbed
   </uploaded_files>
   I've uploaded a python code repository in the directory /testbed. Consider the following PR description:
   
   <pr_description>
   Accessing UserAdmin via to_field leads to link to PasswordResetForm being broken (404)
   Description
   
          (last modified by Simon Kern)
   ...
   ```
   
   è¿™ä¸ªå®ä¾‹æ˜¯åœ¨è§£å†³ä¸Šé¢æ‰€æŒ‡å‘çš„è¿™æ¡æ•°æ®ï¼š
   
   [princeton-nlp/SWE-bench_Lite Â· Datasets at Hugging Face](https://huggingface.co/datasets/princeton-nlp/SWE-bench_Lite/sql-console/fCj5cMg)
   
   å› æ­¤å¯ä»¥çœ‹åˆ°model inputä¸­æ˜¯è¿™æ¡æ•°æ®ä¸­çš„prompt statementï¼Œä¹Ÿå°±æ˜¯github issueä¸­çš„é—®é¢˜æè¿°ã€‚

2. æ¨¡å‹ReActè¿‡ç¨‹
   
   é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œæ¨¡å‹éœ€è¦äº†è§£ä»£ç åº“çš„ä»£ç ä¿¡æ¯ï¼Œå› æ­¤å®ƒæ€è€ƒåå†³å®šç”¨findå‘½ä»¤æ‰¾åˆ°ç›¸å…³æ–‡ä»¶
   
   ```bash
   2025-03-18 12:00:09,582 - INFO - swea-agent - ========================= STEP 1 =========================
   2025-03-18 12:00:12,777 - INFO - swea-lm - Response: ModelResponse(id='chatcmpl-149ba470-6f97-4657-a42b-2a3bf0e60a18', created=1742270412, model='claude-3-5-sonnet-20241022', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content="I'll help you implement the necessary changes to fix the issue with the UserAdmin password reset form link. Let's follow the steps you outlined.\\n\\n1. First, let's find and read the relevant code:", role='assistant', tool_calls=[ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "find /testbed -type f -name \\\\"*.py\\\\" | grep -v \\\\"test\\\\""}', name='bash'), id='toolu_016VGf8bV9xKzjzmtig3nffB', type='function')], function_call=None, provider_specific_fields={'citations': None, 'thinking_blocks': None}))], usage=Usage(completion_tokens=114, prompt_tokens=1838, total_tokens=1952, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), cache_creation_input_tokens=1834, cache_read_input_tokens=0))
   2025-03-18 12:00:12,789 - INFO - swea-agent - ğŸ’­ THOUGHT
   I'll help you implement the necessary changes to fix the issue with the UserAdmin password reset form link. Let's follow the steps you outlined.
   
   1. First, let's find and read the relevant code:
   
   ğŸ¬ ACTION
   find /testbed -type f -name "*.py" | grep -v "test"
   2025-03-18 12:00:13,398 - INFO - swea-agent - ğŸ¤– MODEL INPUT
   Your last command ran successfully and did not produce any output.
   ```
   
   ä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ–‡ä»¶ï¼Œå› æ­¤æ¨¡å‹åˆå¼€å§‹æ–°çš„ReActå¾ªç¯ï¼š
   
   ```
   2025-03-18 12:00:13,401 - INFO - swea-agent - ========================= STEP 2 =========================
   2025-03-18 12:00:16,677 - INFO - swea-lm - Response: ModelResponse(id='chatcmpl-49cf2dc3-b0b7-477e-8a46-f866e43db938', created=1742270416, model='claude-3-5-sonnet-20241022', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content="Hmm, it seems the repository might be empty or the files might be hidden. Let's check what's in the /testbed directory:", role='assistant', tool_calls=[ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "view", "path": "/testbed"}', name='str_replace_editor'), id='toolu_015uJBZxYNjECQtrodxXZ3eb', type='function')], function_call=None, provider_specific_fields={'citations': None, 'thinking_blocks': None}))], usage=Usage(completion_tokens=106, prompt_tokens=1974, total_tokens=2080, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), cache_creation_input_tokens=1969, cache_read_input_tokens=0))
   2025-03-18 12:00:16,695 - INFO - swea-agent - ğŸ’­ THOUGHT
   Hmm, it seems the repository might be empty or the files might be hidden. Let's check what's in the /testbed directory:
   
   ğŸ¬ ACTION
   str_replace_editor view /testbed
   2025-03-18 12:00:17,316 - INFO - swea-agent - ğŸ¤– MODEL INPUT
   OBSERVATION:
   Here's the files and directories up to 2 levels deep in /testbed, excluding hidden items:
   /testbed
   /testbed/CONTRIBUTING.rst
   /testbed/LICENSE.python
   ```
   
   åœ¨æ¨¡å‹çœ‹åˆ°è·¯å¾„ä¹‹åï¼Œæ¨¡å‹ç›´æ¥å¾—å‡ºä¸ºäº†ä¿®æ”¹è¿™ä¸ªç±»ï¼Œéœ€è¦ä¿®æ”¹å“ªäº›æ–‡ä»¶çš„å†³å®šã€‚äº‹å®ä¸Šæ¨¡å‹çš„æ€è€ƒæ˜¯æ­£ç¡®çš„ï¼Œè¿™ä¸€ç‚¹è¿˜æ˜¯éå¸¸çš„ä»¤äººæƒŠè®¶çš„ï¼Œæˆ‘ä½œä¸ºä¸€ä¸ªä»ä¸šç»éªŒè¾ƒä¹…çš„äººä¹Ÿæ²¡åŠæ³•åˆšçœ‹åˆ°è¿™ä¸ªä»“åº“å’Œissueï¼Œå°±çŸ¥é“éœ€è¦ä¿®æ”¹å“ªäº›æ–‡ä»¶ï¼Œæ¨¡å‹æ€è€ƒå¦‚ä¸‹ï¼š
   
   ```
   2025-03-18 12:00:17,331 - INFO - swea-agent - ========================= STEP 3 =========================
   2025-03-18 12:00:21,926 - INFO - swea-lm - Response: ModelResponse(id='chatcmpl-f1421f92-d441-4dc6-bcf8-57af13c361e0', created=1742270421, model='claude-3-5-sonnet-20241022', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content="Based on the PR description, we need to look for the UserChangeForm in the Django admin code. Since this is related to the admin interface and user management, it's likely in the contrib/auth/forms.py or contrib/admin/forms.py. Let's check those files:", role='assistant', tool_calls=[ChatCompletionMessageToolCall(index=1, function=Function(arguments='{"command": "view", "path": "/testbed/django/contrib/auth/forms.py"}', name='str_replace_editor'), id='toolu_01CBdzn8vsPWUbEvrHowgPrm', type='function')], function_call=None, provider_specific_fields={'citations': None, 'thinking_blocks': None}))], usage=Usage(completion_tokens=146, prompt_tokens=5069, total_tokens=5215, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), cache_creation_input_tokens=5064, cache_read_input_tokens=0))
   2025-03-18 12:00:21,937 - INFO - swea-agent - ğŸ’­ THOUGHT
   Based on the PR description, we need to look for the UserChangeForm in the Django admin code. Since this is related to the admin interface and user management, it's likely in the contrib/auth/forms.py or contrib/admin/forms.py. Let's check those files:
   
   ğŸ¬ ACTION
   str_replace_editor view /testbed/django/contrib/auth/forms.py
   2025-03-18 12:00:22,518 - INFO - swea-agent - ğŸ¤– MODEL INPUT
   OBSERVATION:
   <NOTE>This file is too large to display entirely. Showing abbreviated version. Please use `str_replace_editor view` with the `view_range` parameter to show selected lines next.</NOTE>
       1 import unicodedata
       2 
       3 from django import forms
   ```
   
   
